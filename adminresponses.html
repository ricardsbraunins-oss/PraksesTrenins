<!DOCTYPE html>
<html>
<head>
  <title>Admin aptaujas atbildes</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>

<div id="userDisplay" style="
  position: fixed;
  top: 10px;
  right: 15px;
  font-size: 18px;
  color: #00eaff;
"></div>

<script>
  // Protect page
  if (!localStorage.getItem("username")) {
    window.location.href = "login.html";
  }

  // Show username
  const username = localStorage.getItem("username");
  document.getElementById("userDisplay").innerText = username;
</script>

<h2>Visas aptaujas atbildes+admin funkcija</h2>

<table border="1" id="responsesTable">
  <tr>
    <th>Vārds</th>
    <th>Mīļākā krāsa</th>
    <th>Vecums</th>
    <th>Ar ko pārvietojas</th>
    <th>Kur mācās/strādā</th>
    <th>Dzīvo dienesta viesnīcā?</th>
    <th>Dzēst</th>
  </tr>
</table>

<button onclick="window.location.href='forum.html'">Atpakaļ sākumā!</button>

<script type="module">
import { supabase } from './supabase.js';

async function loadResponses() {
  const { data, error } = await supabase
    .from('responses')
    .select('*');

  if (error) {
    alert("Error: " + error.message);
    return;
  }

  const table = document.getElementById("responsesTable");

  data.forEach(row => {
    const newRow = table.insertRow();

    newRow.insertCell(0).innerText = row.q1;
    newRow.insertCell(1).innerText = row.q2;
    newRow.insertCell(2).innerText = row.q3;
    newRow.insertCell(3).innerText = row.q4;
    newRow.insertCell(4).innerText = row.q5;
    newRow.insertCell(5).innerText = row.q6;

    // ✅ DELETE BUTTON inside loop
    const deleteCell = newRow.insertCell(6);
    const deleteBtn = document.createElement("button");
    deleteBtn.style.width = "80px";
    deleteBtn.innerText = "X";
    deleteBtn.style.color = "red";

    deleteBtn.addEventListener("click", async () => {
      if (!confirm("Tiešām dzēst šo ierakstu?")) return;

      await supabase
        .from("responses")
        .delete()
        .eq("id", row.id);

      newRow.remove();
    });

    deleteCell.appendChild(deleteBtn);
  });
}

loadResponses();
</script>

</body>
</html>
