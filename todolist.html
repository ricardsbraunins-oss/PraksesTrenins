<!DOCTYPE html>
<html>
<head>
  <title>todolistatbldes</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>

  <h2>Visi uzdevumi!</h2>

  <table border="1" id="Todolist">
    <tr>
      <th>Uzdevums</th>
      <th>Veids</th>
      <th>Svarīgums</th>
      <th>Pabeigts</th>
    </tr>
  </table>

  <button onclick="window.location.href='todoinput.html'">Jauns ToDo</button>

  <script type="module">
  import { supabase } from './supabase.js';

  // PROTECT THE PAGE
  if (!localStorage.getItem("username")) {
    window.location.href = "login.html";
  }

  async function loadResponses() {
    const { data, error } = await supabase
      .from('todolist')
      .select('*');

    if (error) {
      alert("Error: " + error.message);
      return;
    }

    const table = document.getElementById("Todolist");

    data.forEach(row => {
      const newRow = table.insertRow();
      newRow.insertCell(0).innerText = row.uzd;
      newRow.insertCell(1).innerText = row.uzdveids;
      newRow.insertCell(2).innerText = row.svarigums;

      // ✅ CHECKBOX COLUMN *INSIDE LOOP*
      const checkCell = newRow.insertCell(3);
      const checkbox = document.createElement("input");
      checkbox.type = "checkbox";
      checkbox.checked = row.pabeigts === true;

      checkbox.addEventListener("change", async () => {
        await supabase
          .from("todolist")
          .update({ pabeigts: checkbox.checked })
          .eq("id", row.id);
      });

      checkCell.appendChild(checkbox);
    });
  }

  loadResponses();
</script>


</body>
</html>
